<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="es.uoc.icl.service.CanjeadoRepository">

    <resultMap id="canjeadoResultMap" type="es.uoc.icl.domain.Canjeado">
        <id property="id" column="id"/>
        <result property="total" column="total"/>
        <result property="descuento" column="descuento"/>
        <result property="fechaRegistro" column="fecha_registro_canjeado"/>
        <association property="vale" javaType="es.uoc.icl.domain.Vale">
            <id property="id" column="vale_id"/>
            <result property="fechaLimite" column="fecha_limite"/>
            <result property="valorTotal" column="valor_total"/>
            <result property="lote" column="lote"/>
            <result property="fechaRegistro" column="fecha_registro_vale"/>
        </association>
        <association property="negocio" javaType="es.uoc.icl.domain.Negocio">
            <id property="id" column="negocio_id"/>
            <result property="cif" column="cif_negocio"/>
            <result property="email" column="email_negocio"/>
            <result property="nombre" column="nombre_negocio"/>
            <result property="direccion" column="direccion_negocio"/>
            <result property="valorTotal" column="valor_total_negocio"/>
            <result property="estado" column="estado_negocio"/>
            <result property="fechaRegistro" column="fecha_registro_negocio"/>
        </association>
        <association property="usuario" javaType="es.uoc.icl.domain.Usuario">
            <id property="id" column="usuario_id"/>
            <result property="nombre" column="nombre_usuario"/>
            <result property="apellidos" column="apellidos_usuario"/>
            <result property="documento" column="documento_usuario"/>
            <result property="email" column="email_usuario"/>
            <result property="contrasena" column="contrasena_usuario"/>
            <result property="admin" column="admin_usuario"/>
            <result property="fechaRegistro" column="fecha_registro_usuario"/>
        </association>
    </resultMap>

    <select id="getCanjeado" resultMap="canjeadoResultMap">
        SELECT c.id, c.vale_id, c.negocio_id, c.usuario_id, c.total, c.descuento, c.fecha_registro as fecha_registro_canjeado,
               v.fecha_limite, v.valor_total, v.lote, v.fecha_registro as fecha_registro_vale,
               n.cif as cif_negocio, n.email as email_negocio, n.nombre as nombre_negocio, n.direccion as direccion_negocio,
               n.valor_total as valor_total_negocio, n.estado as estado_negocio, n.fecha_registro as fecha_registro_negocio,
               u.nombre as nombre_usuario, u.apellidos as apellidos_usuario, u.documento as documento_usuario,
               u.email as email_usuario, u.contrasena as contrasena_usuario,
               u.admin as admin_usuario, u.fecha_registro as fecha_registro_usuario
        FROM canjeados c
        JOIN vales v ON c.vale_id = v.id
        JOIN negocios n ON c.negocio_id = n.id
        JOIN usuarios u ON c.usuario_id = u.id
        WHERE c.id = #{idCanjeado}
    </select>

    <select id="getCanjeados" resultMap="canjeadoResultMap">
        SELECT c.id, c.vale_id, c.negocio_id, c.usuario_id, c.total, c.descuento, c.fecha_registro as fecha_registro_canjeado,
               v.fecha_limite, v.valor_total, v.lote, v.fecha_registro as fecha_registro_vale,
               n.cif as cif_negocio, n.email as email_negocio, n.nombre as nombre_negocio, n.direccion as direccion_negocio,
               n.valor_total as valor_total_negocio, n.estado as estado_negocio, n.fecha_registro as fecha_registro_negocio,
               u.nombre as nombre_usuario, u.apellidos as apellidos_usuario, u.documento as documento_usuario,
               u.email as email_usuario, u.contrasena as contrasena_usuario,
               u.admin as admin_usuario, u.fecha_registro as fecha_registro_usuario
        FROM canjeados c
        JOIN vales v ON c.vale_id = v.id
        JOIN negocios n ON c.negocio_id = n.id
        JOIN usuarios u ON c.usuario_id = u.id
    </select>

    <select id="getCanjeadoDeUsuario" resultMap="canjeadoResultMap">
        SELECT c.id, c.vale_id, c.negocio_id, c.usuario_id, c.total, c.descuento, c.fecha_registro as fecha_registro_canjeado,
               v.fecha_limite, v.valor_total, v.lote, v.fecha_registro as fecha_registro_vale,
               n.cif as cif_negocio, n.email as email_negocio, n.nombre as nombre_negocio, n.direccion as direccion_negocio,
               n.valor_total as valor_total_negocio, n.estado as estado_negocio, n.fecha_registro as fecha_registro_negocio,
               u.nombre as nombre_usuario, u.apellidos as apellidos_usuario, u.documento as documento_usuario,
               u.email as email_usuario, u.contrasena as contrasena_usuario,
               u.admin as admin_usuario, u.fecha_registro as fecha_registro_usuario
        FROM canjeados c
        JOIN vales v ON c.vale_id = v.id
        JOIN negocios n ON c.negocio_id = n.id
        JOIN usuarios u ON c.usuario_id = u.id
        WHERE c.usuario_id = #{usuario.id}
    </select>

    <select id="getCanjeadoDeNegocio" resultMap="canjeadoResultMap">
        SELECT c.id, c.vale_id, c.negocio_id, c.usuario_id, c.total, c.descuento, c.fecha_registro as fecha_registro_canjeado,
               v.fecha_limite, v.valor_total, v.lote, v.fecha_registro as fecha_registro_vale,
               n.cif as cif_negocio, n.email as email_negocio, n.nombre as nombre_negocio, n.direccion as direccion_negocio,
               n.valor_total as valor_total_negocio, n.estado as estado_negocio, n.fecha_registro as fecha_registro_negocio,
               u.nombre as nombre_usuario, u.apellidos as apellidos_usuario, u.documento as documento_usuario,
               u.email as email_usuario, u.contrasena as contrasena_usuario,
               u.admin as admin_usuario, u.fecha_registro as fecha_registro_usuario
        FROM canjeados c
        JOIN vales v ON c.vale_id = v.id
        JOIN negocios n ON c.negocio_id = n.id
        JOIN usuarios u ON c.usuario_id = u.id
        WHERE c.negocio_id = #{negocio.id}
    </select>

    <insert id="guardarCanjeado" parameterType="es.uoc.icl.domain.Canjeado">
        INSERT INTO canjeados (vale_id, negocio_id, usuario_id, total, descuento, fecha_registro)
        VALUES (#{vale.id}, #{negocio.id}, #{usuario.id}, #{total}, #{descuento}, #{fechaRegistro})
    </insert>

    <update id="modificarCanjeado" parameterType="es.uoc.icl.domain.Canjeado">
        UPDATE canjeados
        SET vale_id = #{vale.id}, negocio_id = #{negocio.id}, usuario_id = #{usuario.id}, total = #{total},
            descuento = #{descuento}, fecha_registro = #{fechaRegistro}
        WHERE id = #{id}
    </update>

</mapper>
