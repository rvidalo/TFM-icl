<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="es.uoc.icl.service.ValeRepository">

    <resultMap id="vale" type="es.uoc.icl.domain.Vale">
        <id property="id" column="id"/>
        <result property="valorTotal" column="valor_total"/>
        <result property="lote" column="lote"/>
        <result property="fechaLimite" column="fecha_limite"/>
        <result property="fechaRegistro" column="fecha_registro"/>
        <association property="usuario" javaType="es.uoc.icl.domain.Usuario" resultMap="usuario" />
    </resultMap>
    
    <resultMap id="usuario" type="es.uoc.icl.domain.Usuario">
        <id property="id" column="usuario_id"/>
        <result property="nombre" column="usuario_nombre"/>
        <result property="apellidos" column="usuario_apellidos"/>
        <result property="documento" column="usuario_documento"/>
        <result property="email" column="usuario_email"/>
        <result property="contrasena" column="usuario_contrasena"/>
        <result property="admin" column="usuario_admin"/>
	</resultMap>

    <select id="getVale" resultMap="vale">
        SELECT v.id, v.valor_total, v.lote, v.fecha_limite, v.fecha_registro,
        	v.usuario AS usuario_id, u.nombre AS usuario_nombre, u.apellidos AS usuario_apellidos, u.documento AS usuario_documento,
            u.email AS usuario_email, u.contrasena AS usuario_contrasena
        FROM vales v
        JOIN usuarios u ON v.usuario = u.id
        WHERE v.id = #{idVale}
    </select>

    <select id="getValeDeUsuario" resultMap="vale">
        SELECT  v.id, v.valor_total, v.lote, v.fecha_limite, v.fecha_registro,
        	v.usuario AS usuario_id, u.nombre AS usuario_nombre, u.apellidos AS usuario_apellidos, u.documento AS usuario_documento,
            u.email AS usuario_email, u.contrasena AS usuario_contrasena
        FROM vales v
        JOIN usuarios u ON v.usuario = u.id
        WHERE v.email = #{email}
    </select>

    <select id="getVales" resultMap="vale">
        SELECT v.id, v.valor_total, v.lote, v.fecha_limite, v.fecha_registro,
        	v.usuario AS usuario_id, u.nombre AS usuario_nombre, u.apellidos AS usuario_apellidos, u.documento AS usuario_documento,
             u.email AS usuario_email, u.contrasena AS usuario_contrasena
        FROM vales v
        JOIN usuarios u ON v.usuario = u.id
    </select>

    <insert id="guardarVale" parameterType="es.uoc.icl.domain.Vale">
        INSERT INTO vales (usuario, fecha_limite, valor_total, lote, fecha_registro)
        VALUES (#{usuario.id}, #{fechaLimite}, #{valorTotal}, #{lote}, #{fechaRegistro})
    </insert>

    <update id="modificarVale" parameterType="es.uoc.icl.domain.Vale">
        UPDATE vales
        SET usuario = #{usuario.id}, fecha_limite = #{fechaLimite}, valor_total = #{valorTotal}, lote = #{lote}, fecha_registro = #{fechaRegistro}
        WHERE id = #{id}
    </update>

</mapper>
